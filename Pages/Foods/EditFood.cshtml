@page "{id}"
@model FoodManagement.Pages.Foods.EditModel
@{
    ViewData["Title"] = "Sửa món ăn";
}

<h2>Sửa món ăn</h2>

@if (!string.IsNullOrEmpty(Model.Error))
{
    <div class="alert alert-danger">@Model.Error</div>
}
@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="alert alert-success">@Model.Message</div>
}

<form method="post">
    <input type="hidden" asp-for="Food.id" />
    <div class="mb-3">
        <label class="form-label">Tên món ăn</label>
        <input asp-for="Food.name" class="form-control" />
        <span asp-validation-for="Food.name" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Ảnh (image)</label>
        <input asp-for="Food.image" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Banner</label>
        <input asp-for="Food.banner" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Mô tả</label>
        <textarea asp-for="Food.description" class="form-control"></textarea>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            <label class="form-label">Giá</label>
            <input asp-for="Food.price" class="form-control" />
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Giảm giá (%)</label>
            <input asp-for="Food.sale" class="form-control" />
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Phổ biến</label>
            <div class="form-check">
                <input asp-for="Food.popular" class="form-check-input" />
                <label class="form-check-label">Có</label>
            </div>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Images (URLs) — mỗi dòng 1 url</label>
        <textarea id="imagesText" class="form-control">@(
            Model.Food.Images != null ? string.Join("\n", Model.Food.Images.Select(i => i.url)) : ""
        )</textarea>
        <small class="text-muted">Khi lưu, các URL sẽ được chuyển thành ImageDto[].</small>
    </div>

    <button type="submit" class="btn btn-primary">Lưu</button>
    <a asp-page="/Foods/FoodPage" class="btn btn-secondary ms-2">Hủy</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const form = document.querySelector('form');
        form.addEventListener('submit', function () {
            document.querySelectorAll('input[name^="Food.Images"]').forEach(n => n.remove());

            const lines = document.getElementById('imagesText').value
                .split(/\r?\n/)
                .map(l => l.trim())
                .filter(l => l.length > 0);

            lines.forEach((url, idx) => {
                const inUrl = document.createElement('input');
                inUrl.type = 'hidden';
                inUrl.name = `Food.Images[${idx}].url`;
                inUrl.value = url;
                form.appendChild(inUrl);

            });
        });
    </script>
}
